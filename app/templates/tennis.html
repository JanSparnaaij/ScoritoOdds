{% extends "layout.html" %}

{% block content %}
<h1>Tennis Odds</h1>

<!-- League Selection Form -->
<form method="get" action="/tennis">
    <label for="league">Select League:</label>
    <select id="league" name="league" onchange="this.form.submit()">
        {% for league, url in leagues.items() %}
        <option value="{{ league }}" {% if league == selected_league %}selected{% endif %}>
            {{ league.replace('_', ' ').title() }}
        </option>
        {% endfor %}
    </select>

    <!-- Category Filter -->
    <label for="category">Filter by Category:</label>
    <select id="category" name="category" onchange="this.form.submit()">
        {% for category in categories %}
        <option value="{{ category }}" {% if category == selected_category %}selected{% endif %}>
            {{ category if category != 'all' else 'All Categories' }}
        </option>
        {% endfor %}
    </select>
</form>

<!-- Debugging Info -->
{% if matches %}
    <p>{{ matches|length }} matches found in {{ selected_league.replace('_', ' ').title() }}.</p>
{% else %}
    <p>No matches found in {{ selected_league.replace('_', ' ').title() }}.</p>
{% endif %}

<!-- Table for Match Results -->
<table>
    <thead>
        <tr>
            <th>DateTime</th>
            <th>Round</th>
            <th>Player 1</th>
            <th>Player 1 Category</th>
            <th>Player 2</th>
            <th>Player 2 Category</th>
            <th>Player 1 Odds</th>
            <th>Player 2 Odds</th>
            <th>Player 1 Expected Points</th>
            <th>Player 2 Expected Points</th>
        </tr>
    </thead>
    <tbody>
        {% for match in matches %}
        <tr>
            <!-- DateTime -->
            <td>{{ match.date }}</td>

            <!-- Round -->
            <td>{{ match.round }}</td>

            <!-- Player 1 Name and Category -->
            <td {% if match.odds.player1 < match.odds.player2 %}class="highlight"{% endif %}>
                {{ match.players.player1 }}
            </td>
            <td>{{ match.categories.player1 }}</td>

            <!-- Player 2 Name and Category -->
            <td {% if match.odds.player2 < match.odds.player1 %}class="highlight"{% endif %}>
                {{ match.players.player2 }}
            </td>
            <td>{{ match.categories.player2 }}</td>

            <!-- Odds -->
            <td {% if match.odds.player1 < match.odds.player2 %}class="highlight"{% endif %}>
                {{ match.odds.player1 }}
            </td>
            <td {% if match.odds.player2 < match.odds.player1 %}class="highlight"{% endif %}>
                {{ match.odds.player2 }}
            </td>

            <!-- Expected Points -->
            <td>{{ match.expected_points.player1 }}</td>
            <td>{{ match.expected_points.player2 }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
